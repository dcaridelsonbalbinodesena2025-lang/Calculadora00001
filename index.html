<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Predictor Pro: Jogos de Hoje</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0a0a0a; color: white; padding: 10px; display: flex; justify-content: center; }
        .card { background: #161616; padding: 20px; border-radius: 15px; width: 100%; max-width: 480px; border: 1px solid #333; }
        
        #resultado { background: #1f1f1f; border-radius: 10px; padding: 15px; margin-bottom: 20px; border-bottom: 4px solid #00e676; display: none; text-align: center; }
        .highlight { color: #00e676; font-weight: bold; font-size: 24px; }
        .total-gols { font-size: 32px; color: #ffeb3b; font-weight: bold; }

        /* Estilo do Seletor de Jogos */
        .selector-container { margin-bottom: 20px; }
        select { width: 100%; padding: 12px; background: #222; color: #00e676; border: 1px solid #444; border-radius: 8px; font-size: 14px; cursor: pointer; }
        
        .table-header { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; text-align: center; color: #666; font-size: 10px; margin-bottom: 5px; }
        .row { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; gap: 5px; margin-bottom: 10px; }
        input { background: #252525; border: 1px solid #444; color: white; padding: 10px 2px; text-align: center; border-radius: 5px; width: 100%; font-weight: bold; }
        
        .team-name { font-size: 11px; color: #aaa; margin-bottom: 5px; text-transform: uppercase; display: block; }
        .btn-calc { width: 100%; padding: 15px; background: #00e676; color: #000; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .loader { color: #ffeb3b; font-size: 12px; text-align: center; margin-bottom: 10px; display: none; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="text-align:center; font-size: 1rem; color: #888;">ANALISTA DE JOGOS DO DIA</h2>

    <div id="resultado">
        <div style="display: flex; justify-content: space-around;">
            <div><small id="nomeA_res">TIME A</small><br><span class="highlight" id="resA">0%</span></div>
            <div><small id="nomeB_res">TIME B</small><br><span class="highlight" id="resB">0%</span></div>
        </div>
        <hr style="border: 0.5px solid #333; margin: 10px 0;">
        <div><small>PREVISÃO TOTAL DE GOLS (OVER)</small><br><span class="total-gols" id="resGols">0.00</span></div>
    </div>

    <div class="selector-container">
        <label style="font-size: 10px; color: #666;">SELECIONE O CONFRONTO DE HOJE:</label>
        <select id="listaJogos" onchange="carregarConfronto()">
            <option value="">Carregando jogos...</option>
        </select>
    </div>

    <div id="loader" class="loader">Buscando estatísticas...</div>

    <div class="table-header">
        <div>V</div><div>E</div><div>D</div><div>GP</div><div>GC</div>
    </div>

    <span id="labelA" class="team-name">Time Casa</span>
    <div class="row">
        <input type="number" id="vA" readonly> <input type="number" id="eA" readonly>
        <input type="number" id="dA" readonly> <input type="number" id="gpA" readonly>
        <input type="number" id="gcA" readonly>
    </div>

    <span id="labelB" class="team-name">Time Fora</span>
    <div class="row">
        <input type="number" id="vB" readonly> <input type="number" id="eB" readonly>
        <input type="number" id="dB" readonly> <input type="number" id="gpB" readonly>
        <input type="number" id="gcB" readonly>
    </div>

    <button class="btn-calc" onclick="calcular()">GERAR PROBABILIDADE</button>
</div>

<script>
const KEY = "2da2349a9973927cf05b78efe04d3b90";
const HEADERS = { "x-rapidapi-host": "v3.football.api-sports.io", "x-rapidapi-key": KEY };

// 1. Carregar lista de jogos do dia ao abrir
async function buscarJogosDoDia() {
    const hoje = new Date().toISOString().split('T')[0];
    try {
        const res = await fetch(`https://v3.football.api-sports.io/fixtures?date=${hoje}`, { headers: HEADERS });
        const data = await res.json();
        const select = document.getElementById('listaJogos');
        select.innerHTML = '<option value="">Escolha um jogo...</option>';

        data.response.forEach(f => {
            const opt = document.createElement('option');
            opt.value = JSON.stringify({idA: f.team.home.id, idB: f.team.away.id, league: f.league.id, season: f.league.season, nA: f.teams.home.name, nB: f.teams.away.name});
            opt.innerText = `${f.league.name}: ${f.teams.home.name} x ${f.teams.away.name}`;
            select.appendChild(opt);
        });
    } catch (e) { alert("Erro ao carregar jogos."); }
}

// 2. Buscar estatísticas ao selecionar o jogo
async function carregarConfronto() {
    const info = JSON.parse(document.getElementById('listaJogos').value);
    document.getElementById('loader').style.display = 'block';
    
    document.getElementById('labelA').innerText = info.nA;
    document.getElementById('labelB').innerText = info.nB;

    await puxarStats('A', info.idA, info.league, info.season);
    await puxarStats('B', info.idB, info.league, info.season);
    
    document.getElementById('loader').style.display = 'none';
}

async function puxarStats(tipo, id, league, season) {
    const res = await fetch(`https://v3.football.api-sports.io/teams/statistics?league=${league}&season=${season}&team=${id}`, { headers: HEADERS });
    const data = await res.json();
    const s = data.response;
    
    document.getElementById('v' + tipo).value = s.fixtures.wins.total || 0;
    document.getElementById('e' + tipo).value = s.fixtures.draws.total || 0;
    document.getElementById('d' + tipo).value = s.fixtures.loses.total || 0;
    document.getElementById('gp' + tipo).value = s.goals.for.total.total || 0;
    document.getElementById('gc' + tipo).value = s.goals.against.total.total || 0;
}

function calcular() {
    const get = (id) => parseFloat(document.getElementById(id).value) || 0;
    const vA = get('vA'), eA = get('eA'), dA = get('dA'), gpA = get('gpA'), gcA = get('gcA');
    const vB = get('vB'), eB = get('eB'), dB = get('dB'), gpB = get('gpB'), gcB = get('gcB');
    
    const jA = vA + eA + dA, jB = vB + eB + dB;
    if(jA === 0) return alert("Dados insuficientes para o cálculo.");

    const forcaA = (vA/jA) * (dB/jB) + 0.01;
    const forcaB = (vB/jB) * (dA/jA) + 0.01;
    const pA = (forcaA / (forcaA + forcaB)) * 100;
    const xG = ((gpA/jA + gcB/jB)/2) + ((gpB/jB + gcA/jA)/2);

    document.getElementById('resultado').style.display = 'block';
    document.getElementById('resA').innerText = pA.toFixed(1) + "%";
    document.getElementById('resB').innerText = (100 - pA).toFixed(1) + "%";
    document.getElementById('resGols').innerText = xG.toFixed(2);
    document.getElementById('nomeA_res').innerText = document.getElementById('labelA').innerText;
    document.getElementById('nomeB_res').innerText = document.getElementById('labelB').innerText;
}

buscarJogosDoDia();
</script>
</body>
</html>
